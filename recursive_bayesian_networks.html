

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recursive Bayesian Networks &mdash; rbnet  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="_static/autoclasstoc.css?v=08871587" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Gallery and Examples" href="auto_examples/index.html" />
    <link rel="prev" title="Recursive Bayesian Networks" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            rbnet
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Recursive Bayesian Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#inside-probabilities">Inside Probabilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#binary-case">Binary Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-case">General Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-sequential-case">Non-Sequential Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#outside-probabilities">Outside Probabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Marginal Likelihood</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing">Parsing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auto_examples/index.html">Gallery and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_summary.html">API Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">rbnet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Recursive Bayesian Networks</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="recursive-bayesian-networks">
<h1>Recursive Bayesian Networks<a class="headerlink" href="#recursive-bayesian-networks" title="Link to this heading"></a></h1>
<section id="inside-probabilities">
<h2>Inside Probabilities<a class="headerlink" href="#inside-probabilities" title="Link to this heading"></a></h2>
<p>The inside probability</p>
<div class="admonition-inside-probability admonition">
<p class="admonition-title">Inside Probability</p>
<div class="math">
<p><img src="_images/math/a249e2804f25fb4b9998105ed913eb9b238c109b.svg" alt="\beta(x_{i:k}) = p(\mathbf{Y}_{i:k} \ |\ x_{i:k})"/></p>
</div></div>
<p>is the probability of generating the subsequence of terminal variables
<img class="math" src="_images/math/c3685b5f038291988c53d67b91626e110b6a187c.svg" alt="\mathbf{Y}_{i:k}=\{y_{i+1},\ldots,y_{k}\}"/>
from the non-terminal variable
<img class="math" src="_images/math/4425269fbb32e38b9240534ff76a857c1f4a7a2c.svg" alt="x_{i:k}"/>
with all intermediate variables marginalised out.</p>
<section id="binary-case">
<h3>Binary Case<a class="headerlink" href="#binary-case" title="Link to this heading"></a></h3>
<p>This can be best understood by looking at a simple example with a single non-terminal template variable and a binary split transition:</p>
<img alt="Tree diagram" src="_images/tree.svg" />
<p>The inside probability <img class="math" src="_images/math/e23463d19f9e15486fbe8ecec1bfe26fc96f93df.svg" alt="\beta(x_{1:9})"/> is the probability of generating the subsequence of terminal variables
<img class="math" src="_images/math/0db130d0134dc872b137fb6e613ff9ec4a460f61.svg" alt="\mathbf{Y}_{1:9}=\{y_{2},\ldots,y_{9}\}"/>
from the non-terminal variable
<img class="math" src="_images/math/046dbe3d14b8d0c933653f688e4c4d4ca95b1fb2.svg" alt="x_{1:9}"/>.
Its value can be computed recursively by looking one step ahead in the generating process and considering all possibilities.
In this simple case, the next step will always produce two child variables and the different possibilities are simply which part
of the sequence is generated by which of the children. This includes the three possibilities illustrated above:</p>
<blockquote>
<div><ul class="simple">
<li><p>…</p></li>
<li><p>orange [split at <img class="math" src="_images/math/64a3ea9adf95e683eeb2aecc48e8b7f703e76055.svg" alt="j=4"/>]: the left child <img class="math" src="_images/math/effc3f244cce0b5a2a7f540b4d06dd9ae1e5c5f0.svg" alt="x_{1:4}"/> generates <img class="math" src="_images/math/3f6f7f1b0e58c49774200de5a46f1983f94ab379.svg" alt="\{y_2,\ldots,y_4\}"/>; the right child <img class="math" src="_images/math/3716dea8e5b1e2e79dfad6b3b1d7591fc2fc7c6b.svg" alt="x_{4:9}"/> generates <img class="math" src="_images/math/89dae0353e9963085fb26a7b1f0c46bcf90e6348.svg" alt="\{y_5,\ldots,y_9\}"/></p></li>
<li><p>blue [split at <img class="math" src="_images/math/16329a05c3e1c48a3d561ce64e92d7bb65ddabac.svg" alt="j=5"/>]: the left child <img class="math" src="_images/math/f94a85c10211ea799d71fdd064731b1cd8ee11da.svg" alt="x_{1:5}"/> generates <img class="math" src="_images/math/f1f9a4ae99c36669cb9841b5365c31bc46afff9b.svg" alt="\{y_2,\ldots,y_5\}"/>; the right child <img class="math" src="_images/math/bcade1fe30ea913b69b88cadde80b94bf13584a6.svg" alt="x_{5:9}"/> generates <img class="math" src="_images/math/b7e9fdc8b8402f068bd82641e38fb118e8d9166b.svg" alt="\{y_6,\ldots,y_9\}"/></p></li>
<li><p>green [split at <img class="math" src="_images/math/7ed3f7d331508bf53266800997e53354b9ed775d.svg" alt="j=6"/>]: the left child <img class="math" src="_images/math/349c586badf5ea1dea7eae171a2f59d1eb8169b1.svg" alt="x_{1:6}"/> generates <img class="math" src="_images/math/116219f28ffd59c530fd91fe709f1687e006a090.svg" alt="\{y_2,\ldots,y_6\}"/>; the right child <img class="math" src="_images/math/6d2f6b891fb7f2b347f1ba515e4301120fdaa9ea.svg" alt="x_{6:9}"/> generates <img class="math" src="_images/math/492589cea64e4f43921253ee45260c6bd3d4ae92.svg" alt="\{y_7,\ldots,y_9\}"/>.</p></li>
<li><p>…</p></li>
</ul>
</div></blockquote>
<p>but splitting points <img class="math" src="_images/math/e3fc28292267f066fee7718c64f4bbfece521f24.svg" alt="j"/> can go from 2 up to 8 (<img class="math" src="_images/math/cbed010d446e101a68b31531f3e6f8c5b0b46292.svg" alt="i&lt;j&lt;k"/>). These different possibilities have to be summed up and the intermediate variables (the left and right child) have to be marginalised out:</p>
<div class="admonition-inside-probabilities-binary-case admonition">
<p class="admonition-title">Inside Probabilities (Binary Case)</p>
<div class="math">
<p><img src="_images/math/2766c6960c6b9300765487843b4b94be65a9eeab.svg" alt="\beta(x_{i:k})
={}&amp;
p_S(z_{i:k}=\tau \mid x_{i:k})
\sum_{i&lt;j&lt;k}
\int\int
p_{\tau}(x_{i:j}, x_{j:k} \mid x_{i:k}) \
\beta(x_{i:j}) \beta(x_{j:k}) \
dx_{i:j} dx_{j:k}"/></p>
</div></div>
<p>Here, the sum runs over all possible splitting points and the integrals marginalise out the intermediate (child) variables.
The inside probabilities <img class="math" src="_images/math/75f5040da31d0e9b0287cd6b616f8dcda35c215b.svg" alt="\beta(x_{i:j})"/> and <img class="math" src="_images/math/463ad34bce16442140fee1fc93a11a65df24beab.svg" alt="\beta(x_{j:k})"/> are the recursive part and “hide” all subsequent generation steps from the children on.
Finally, the particular binary transition that we considered here (denoted by <img class="math" src="_images/math/914b2d4b6659b86d3153d5510839dfb254dfc8a3.svg" alt="\tau"/>) is usually only one of multiple possible transitions (at least one other transition is needed to generate terminal variables).
We therefore have to multiply everything by the probability of taking this particular transition, which is the first term with the structural distribution <img class="math" src="_images/math/356d1bf055077197b8651ee1cec97a7b822844be.svg" alt="p_S"/>.</p>
</section>
<section id="general-case">
<span id="general-inside-probabilities"></span><h3>General Case<a class="headerlink" href="#general-case" title="Link to this heading"></a></h3>
<p>If the simple binary case is clear, it is much easier to understand the more complex general case, which differs in the following.</p>
<p><strong>Multiple template variables:</strong> So far, we had a single non-terminal template variable <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/> that could be instantiated at any possible location <img class="math" src="_images/math/d67a124e217ecb7ad9e76d1616053e01b657401d.svg" alt="i:k"/> in the parse chart (<img class="math" src="_images/math/4425269fbb32e38b9240534ff76a857c1f4a7a2c.svg" alt="x_{i:k}"/>). In other words, the set of non-terminal template variables <img class="math" src="_images/math/35934ec49b4c4203a014d2b6114c68b9b16e45eb.svg" alt="\mathcal{X}"/> contained a single variable <img class="math" src="_images/math/bbabe3e2e9eab12372aa3b962e2d8144eb1c3e4a.svg" alt="\mathcal{X}=\{x\}"/>. However, in general, <img class="math" src="_images/math/35934ec49b4c4203a014d2b6114c68b9b16e45eb.svg" alt="\mathcal{X}"/> may contain an arbitrary number of non-terminal template variables <img class="math" src="_images/math/ab0dd58942b0635d81dfdf0cc7e3c9558d835b18.svg" alt="\mathcal{X}=\{x^{(1)},x^{(2)},\ldots\}"/>. The same is true for the set of terminal template variables <img class="math" src="_images/math/3ac4b2357df76bf21ad1b02997fda1db0f8a34a4.svg" alt="\mathcal{Y}=\{y^{(1)},y^{(2)},\ldots\}"/>.</p>
<p><strong>Multiple possible transitions:</strong> As mentioned above, even in the simple binary case, there has to be at least one other transition to generate the terminal variables (as the binary split only generates two new non-terminal variables). In general, there may be an arbitrary number of transitions <img class="math" src="_images/math/882770155f73b50224d77f43ec8b77f267d6844c.svg" alt="\tau\in\mathcal{T}_x"/> from a particular non-terminal variable <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/> and each transition may involve any number of terminal or non-terminal variables <img class="math" src="_images/math/b571935312d963d5460edd73242c01a3f2ff312d.svg" alt="v\in\mathcal{X}\cup\mathcal{Y}"/>.</p>
<p><strong>Multiple splitting points:</strong> If a transition generates more than two variables, there is more than one splitting point. To be precise, if a transition generates <img class="math" src="_images/math/97db043c7cba573ac389b71add78b048077e8a13.svg" alt="\eta"/> variables, there are <img class="math" src="_images/math/39aeb1dd5cd3ec255017ee22240d5bd87b9d81cf.svg" alt="\eta-1"/> splitting points, which we can denote by <img class="math" src="_images/math/70fd820da6425e7dac1cbda4b357a224e16b6b84.svg" alt="j_1,\ldots,j_{\eta-1}"/>.</p>
<p>Taking this into account, the general form of the inside probabilities for the non-terminal variable <img class="math" src="_images/math/4425269fbb32e38b9240534ff76a857c1f4a7a2c.svg" alt="x_{i:k}"/> is given by</p>
<div class="admonition-inside-probabilities-general-case admonition">
<p class="admonition-title">Inside Probabilities (General Case)</p>
<div class="math">
<p><img src="_images/math/ca423754f480aec24a67e6f533a9d4da2994e2a9.svg" alt="\beta(x_{i:k})
={}&amp;
\sum_{\tau \in \mathcal{T}_x}
p_S(z_{i:k}=\tau \mid x_{i:k})
{\sum\cdots\sum}_{i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k} \\
&amp; {\int\cdots\int}_{\{v_{j:j^\prime}\}\subseteq\mathcal{X}}
p_{\tau}(v_{i:j_1}, \ldots, v_{j_{\eta-1}:k} \mid x_{i:k})
\prod_{\{v_{j:j^\prime}\}\subseteq\mathcal{X}}
\beta(v_{j:j^\prime})."/></p>
</div></div>
<p>We denote the second line as <em>inside marginals</em> <img class="math" src="_images/math/1a553e1552dd63399f9c62567051189758dc49e7.svg" alt="\widetilde{\beta}_{i:\ldots:k}(x_{i:k})"/></p>
<div class="admonition-inside-marginals admonition">
<p class="admonition-title">Inside Marginals</p>
<div class="math">
<p><img src="_images/math/0dc881d7ffc9b3e201d7cbbc0e3ac785ad6afc22.svg" alt="\widetilde{\beta}_{i:\ldots:k}(x_{i:k})
=
{\int\cdots\int}_{\{v_{j:j^\prime}\}\subseteq\mathcal{X}}
p_{\tau}(v_{i:j_1}, \ldots, v_{j_{\eta-1}:k} \mid x_{i:k})
\prod_{\{v_{j:j^\prime}\}\subseteq\mathcal{X}}
\beta(v_{j:j^\prime}),"/></p>
</div></div>
<p>where the subscript <img class="math" src="_images/math/857fc47d8a75282808a2ca56167a0fea695f9d72.svg" alt="i:\ldots:k"/> indicates the dependency on <img class="math" src="_images/math/48d45282df2b7588f94d20d53802e868ee55d4a4.svg" alt="i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k"/>.
This is implemented in <a class="reference internal" href="_autosummary/rbnet.base.Transition.html#rbnet.base.Transition.inside_marginals" title="rbnet.base.Transition.inside_marginals"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transition.inside_marginals()</span></code></a>, which returns
an array or iterable over all possible inside marginals <img class="math" src="_images/math/1a553e1552dd63399f9c62567051189758dc49e7.svg" alt="\widetilde{\beta}_{i:\ldots:k}(x_{i:k})"/> for the
different (combinations of) splitting points.</p>
<p>We denote the summation in the first line as <em>inside mixture</em></p>
<div class="admonition-inside-mixture admonition">
<p class="admonition-title">Inside Mixture</p>
<div class="math">
<p><img src="_images/math/5c5094fbbb2be478b4d4a9037977a4fe0c0abf53.svg" alt="\beta(x_{i:k})
=
\sum_{\tau \in \mathcal{T}_x}
p_S(z_{i:k}=\tau \mid x_{i:k})
{\sum\cdots\sum}_{i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k} \ \widetilde{\beta}_{i:\ldots:k}(x_{i:k}),"/></p>
</div></div>
<p>which uses the inside marginals
<img class="math" src="_images/math/1a553e1552dd63399f9c62567051189758dc49e7.svg" alt="\widetilde{\beta}_{i:\ldots:k}(x_{i:k})"/> to compute the (multi-)sum over possible (combinations of) splitting
points as well as the sum over possible transitions weighted by the structural distribution.
This is implemented in <a class="reference internal" href="_autosummary/rbnet.base.Cell.html#rbnet.base.Cell.inside_mixture" title="rbnet.base.Cell.inside_mixture"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cell.inside_mixture()</span></code></a>.</p>
<p>To explain the different parts of the equation in more detail, we have:</p>
<ul class="simple">
<li><p>The sum over all possible transitions for the given variable, weighting each transition by its probability to
occur, given by the structural distribution:</p></li>
</ul>
<div class="math">
<p><img src="_images/math/6199f9662701d9d327e70c8648f6f124482b94ad.svg" alt="\sum_{\tau \in \mathcal{T}_x}
p_S(z_{i:k}=\tau \mid x_{i:k})"/></p>
</div><ul class="simple">
<li><p>The multi-sum over all possible combinations of splitting points. For the simple binary case, where we only have a
single splitting point, this reduces to the simple sum from above. A larger number of splitting points quickly
becomes computationally expensive as the number of possibilities grows exponentially (and is also more difficult to
vectorise):</p></li>
</ul>
<div class="math">
<p><img src="_images/math/716e925cb311f6d77c5e2a885b1477aa24bd4089.svg" alt="{\sum\cdots\sum}_{i&lt;j_1&lt;\ldots&lt;j_{\eta-1}&lt;k}"/></p>
</div><ul class="simple">
<li><p>The multi-integral to marginalise out the set of generated non-terminal (child) variables (denoted by
<img class="math" src="_images/math/ab634f3978687c8af24406d2715939954df38919.svg" alt="\{v_{j:j^\prime}\}\subseteq\mathcal{X}"/>). Importantly, this does not include any terminal variables that may have been
generated along with the non-terminal variables:</p></li>
</ul>
<div class="math">
<p><img src="_images/math/8496ad605eaff669173e8f1cb3cf11247a7e59b7.svg" alt="&amp; {\int\cdots\int}_{\{v_{j:j^\prime}\}\subseteq\mathcal{X}}"/></p>
</div><ul class="simple">
<li><p>The actual transition probability. The generated variables <img class="math" src="_images/math/a1a55ef54963e3d9813e1ed86db76ec14194cdd0.svg" alt="v_{i:j_1}, \ldots, v_{j_{\eta-1}:k}"/> may contain
both non-terminal variables and terminal variables:</p></li>
</ul>
<div class="math">
<p><img src="_images/math/22989393795b1fdd8b831c2c84f267977e1dfe1b.svg" alt="p_{\tau}(v_{i:j_1}, \ldots, v_{j_{\eta-1}:k} \mid x_{i:k})"/></p>
</div><ul class="simple">
<li><p>The recursive part containing the product of inside probabilities of all generated non-terminal variables.</p></li>
</ul>
<div class="math">
<p><img src="_images/math/90679f10f890f3f936dbc7eef7f96269afa74d21.svg" alt="\prod_{\{v_{j:j^\prime}\}\subseteq\mathcal{X}}
\beta(v_{j:j^\prime})."/></p>
</div></section>
<section id="non-sequential-case">
<span id="marginal-likelihood"></span><h3>Non-Sequential Case<a class="headerlink" href="#non-sequential-case" title="Link to this heading"></a></h3>
<p>Everything transfers to the non-sequential case, which is more abstract but the equations become simpler.</p>
<div class="admonition-inside-probabilities-non-sequential admonition">
<p class="admonition-title">Inside Probabilities (Non-Sequential)</p>
<div class="math">
<p><img src="_images/math/228b21553edc589dac2a132db8ce4fdd291735fd.svg" alt="\begin{aligned}
\beta(x_\pi) ={}&amp; p(\mathbf{Y}_\pi \ |\ x_\pi) \\
={}&amp;
\sum_{\tau \in \mathcal{T}_x}
p_S(z_{\pi}=\tau \mid x_{\pi})
\sum_{(\pi_1,\pi_2,\ldots)\in\mathcal{P}_\tau(\pi)}
\underbrace{
\int_{\{v_{\pi_i}\}\subseteq\mathcal{X}}
p_{\tau}(v_{\pi_1}, v_{\pi_2}, \ldots \mid x_{\pi})
\prod_{\{v_{\pi_i}\}\subseteq\mathcal{X}} \beta(v_{\pi_i})
}_{\widetilde{\beta}^{(\tau)}_{(\pi_1,\pi_2,\ldots)}(x_\pi)} \\
={}&amp;
\sum_{\tau \in \mathcal{T}_x}
p_S(z_{\pi}=\tau \mid x_{\pi})
\sum_{(\pi_1,\pi_2,\ldots)\in\mathcal{P}_\tau(\pi)}
{\widetilde{\beta}^{(\tau)}_{(\pi_1,\pi_2,\ldots)}(x_\pi)}
&amp; \text{\makebox[0pt][r]{(Inside Mixture)}} \\
\widetilde{\beta}^{(\tau)}_{(\pi_1,\pi_2,\ldots)}(x_\pi)
={}&amp;
\int_{\{v_{\pi_i}\}\subseteq\mathcal{X}}
p_{\tau}(v_{\pi_1}, v_{\pi_2}, \ldots \mid x_{\pi})
\prod_{\{v_{\pi_i}\}\subseteq\mathcal{X}}
\beta(v_{\pi_i}),
&amp; \text{\makebox[0pt][r]{(Inside Marginals)}}
\end{aligned}"/></p>
</div></div>
<p>where</p>
<ul class="simple">
<li><p><img class="math" src="_images/math/9cc8517129c87252edd7fe2e4532af9dcf7a54d9.svg" alt="\pi"/> references a subset of terminal variables</p></li>
<li><p><img class="math" src="_images/math/1c1627dd19cb2c8aa850c6bb7f01a53e937423e9.svg" alt="\mathbf{Y}_\pi"/> is the actual subset of terminal variables referenced by <img class="math" src="_images/math/9cc8517129c87252edd7fe2e4532af9dcf7a54d9.svg" alt="\pi"/></p></li>
<li><p><img class="math" src="_images/math/8c2bb76bffc6b5e8fb3799002ee2d9146e130123.svg" alt="\beta(x_\pi)"/> is the probability of generating <img class="math" src="_images/math/1c1627dd19cb2c8aa850c6bb7f01a53e937423e9.svg" alt="\mathbf{Y}_\pi"/> conditional on the non-terminal variable
<img class="math" src="_images/math/3d3e268b68fd967a6112ce41ee66b9554db27b8a.svg" alt="x_\pi"/> with all intermediate variables marginalised out</p></li>
<li><p><img class="math" src="_images/math/daeb91568b4074c802f91b96bd6971d27eff24d3.svg" alt="\mathcal{P}_\tau(\pi)"/> is the set of all possible partitionings of <img class="math" src="_images/math/9cc8517129c87252edd7fe2e4532af9dcf7a54d9.svg" alt="\pi"/> compatible with transition
<img class="math" src="_images/math/914b2d4b6659b86d3153d5510839dfb254dfc8a3.svg" alt="\tau"/>, in particular, for transitions with a fixed arity <img class="math" src="_images/math/97db043c7cba573ac389b71add78b048077e8a13.svg" alt="\eta"/>, the number of parts must equal
<img class="math" src="_images/math/97db043c7cba573ac389b71add78b048077e8a13.svg" alt="\eta"/> (the number of variables produced by <img class="math" src="_images/math/914b2d4b6659b86d3153d5510839dfb254dfc8a3.svg" alt="\tau"/>)</p></li>
<li><p><img class="math" src="_images/math/dfc66c3335cc625dbf7fa3985126bc5e3a7247fc.svg" alt="(\pi_1,\pi_2,\ldots)\in\mathcal{P}_\tau(\pi)"/> is one particular partition, so that each <img class="math" src="_images/math/099642c989a7436f90fecd652aaaf67e2e34b096.svg" alt="\pi_i"/> is
the subset of data points represented by the variable <img class="math" src="_images/math/ae58a50706ab238e599139c27d09fd4f0c361e70.svg" alt="v_{\pi_i}"/>.</p></li>
</ul>
<p>This formulation also generalises to context-free graph grammars. For instance, in node-replacement graph grammars,
variables correspond to nodes and each transition <img class="math" src="_images/math/914b2d4b6659b86d3153d5510839dfb254dfc8a3.svg" alt="\tau"/> defines additional constraints for the partition
<img class="math" src="_images/math/dfc66c3335cc625dbf7fa3985126bc5e3a7247fc.svg" alt="(\pi_1,\pi_2,\ldots)\in\mathcal{P}_\tau(\pi)"/>, such that the node replacement rule is fulfilled.</p>
</section>
</section>
<section id="outside-probabilities">
<h2>Outside Probabilities<a class="headerlink" href="#outside-probabilities" title="Link to this heading"></a></h2>
<p>For simplicity, we directly provide the outside probabilities for the general non-sequential case.</p>
<div class="admonition-outside-probabilities admonition">
<p class="admonition-title">Outside Probabilities</p>
<div class="math">
<p><img src="_images/math/d9a7e7c84e7cc505cf54f16e3e6309e45cb9b877.svg" alt="\begin{aligned}
\alpha(x_\pi) ={}&amp; p(x_\pi, \mathbf{Y} \setminus \mathbf{Y}_\pi) \\
={}&amp;
\sum_{\bar{\tau} \in \bar{\mathcal{T}}_x} \
\sum_{(\bar{\pi},\pi_1,\pi_2,\ldots)\in\bar{\mathcal{P}}_{\bar{\tau}}(\pi)}
\underbrace{
\int_{\bar{x}_{\bar{\pi}}}
\int_{\{v_{\pi_i}\}\subseteq\mathcal{X}}
p_S(z_{\bar{\pi}}=\bar{\tau} \mid \bar{x}_{\bar{\pi}}) \
p_{\bar{\tau}}(x_{\pi}, v_{\pi_1}, v_{\pi_2}, \ldots \mid \bar{x}_{\bar{\pi}}) \
\alpha(\bar{x}_{\bar{\pi}})
\prod_{\{v_{\pi_i}\}\subseteq\mathcal{X}} \beta(v_{\pi_i})
}_{\widetilde{\alpha}^{(\bar{\tau})}_{(\bar{\pi},\pi_1,\pi_2,\ldots)}(x_\pi)} \\
={}&amp;
\sum_{\bar{\tau} \in \bar{\mathcal{T}}_x} \
\sum_{(\bar{\pi},\pi_1,\pi_2,\ldots)\in\bar{\mathcal{P}}_{\bar{\tau}}(\pi)}
\widetilde{\alpha}^{(\bar{\tau})}_{(\bar{\pi},\pi_1,\pi_2,\ldots)}(x_\pi)
&amp; \text{\makebox[0pt][r]{(Outside Mixture)}} \\
\widetilde{\alpha}^{(\bar{\tau})}_{(\bar{\pi},\pi_1,\pi_2,\ldots)}(x_\pi)
={}&amp;
\int_{\bar{x}_{\bar{\pi}}}
\int_{\{v_{\pi_i}\}\subseteq\mathcal{X}}
p_S(z_{\bar{\pi}}=\bar{\tau} \mid \bar{x}_{\bar{\pi}}) \
p_{\bar{\tau}}(x_{\pi}, v_{\pi_1}, v_{\pi_2}, \ldots \mid \bar{x}_{\bar{\pi}}) \
\alpha(\bar{x}_{\bar{\pi}})
\prod_{\{v_{\pi_i}\}\subseteq\mathcal{X}} \beta(v_{\pi_i})
&amp; \text{\makebox[0pt][r]{(Outside Marginals)}}
\end{aligned}"/></p>
</div></div>
<p>where</p>
<ul>
<li><p><img class="math" src="_images/math/dedfcdfb942a15069f3fb6713c955d767e10eb70.svg" alt="\mathbf{Y} \setminus \mathbf{Y}_\pi"/> the set of all terminal variables without by <img class="math" src="_images/math/1c1627dd19cb2c8aa850c6bb7f01a53e937423e9.svg" alt="\mathbf{Y}_\pi"/>,
that is, the complement of the variables from respective the inside probabilities</p></li>
<li><p><img class="math" src="_images/math/9cc835d0a190e99d09b6f087093b75ca9fc657ec.svg" alt="\alpha(x_\pi)"/> is the joint probability of generating <img class="math" src="_images/math/3d3e268b68fd967a6112ce41ee66b9554db27b8a.svg" alt="x_\pi"/> and all terminal variables
<img class="math" src="_images/math/dedfcdfb942a15069f3fb6713c955d767e10eb70.svg" alt="\mathbf{Y} \setminus \mathbf{Y}_\pi"/></p></li>
<li><p><img class="math" src="_images/math/ed4436646bb0c357b1a73d720a3fb6f531b71e34.svg" alt="\bar{\mathcal{T}}_x"/> is the set of transitions that include <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/> as one of the generated variables;
if <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/> appears multiple times in the generated variables, these are listed as separate transitions
<img class="math" src="_images/math/816669ded82ec7ea0f1cd02ae94982e0e0e38bb7.svg" alt="\bar{\tau}"/> and the position of the respective occurrence of <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/> is marked and used in the evaluation
of <img class="math" src="_images/math/265fa7f0832a7f8362935adaa8aeca1b02ebde20.svg" alt="p_{\bar{\tau}}"/></p></li>
<li><p><img class="math" src="_images/math/fe2e22f5f9d7c85e2bc93fce02f09e42e8abe541.svg" alt="\bar{\pi}, \pi, \pi_1, \pi_2, \ldots"/> reference subsets of terminal variables, such that
<img class="math" src="_images/math/bb82299e2357b47d4a1294a6d926774b9d07bef0.svg" alt="\pi, \pi_1, \pi_2, \ldots"/> is a partition of <img class="math" src="_images/math/60550fda14d84c693273f8faa2916aaad58d41c4.svg" alt="\bar{\pi}"/>, and</p>
<div class="math">
<p><img src="_images/math/6d2aa65ef37565370da56ac16efda9e6c3cd0ef4.svg" alt="\bar{\mathcal{P}}_{\bar{\tau}}(\pi)
 = \{ (\bar{\pi},\pi_1,\pi_2,\ldots) \ | \ \pi, \pi_1, \pi_2, \cdots \text{ partitions } \bar{\pi} \}"/></p>
</div><p>is the set of all such possibilities compatible with transition <img class="math" src="_images/math/816669ded82ec7ea0f1cd02ae94982e0e0e38bb7.svg" alt="\bar{\tau}"/>; note that
the elements of <img class="math" src="_images/math/dddf15fcc1474fc19c00d50d34221d947d15bd9a.svg" alt="\bar{\mathcal{P}}_{\bar{\tau}}(\pi)"/> contain the parent set <img class="math" src="_images/math/60550fda14d84c693273f8faa2916aaad58d41c4.svg" alt="\bar{\pi}"/>, not <img class="math" src="_images/math/9cc8517129c87252edd7fe2e4532af9dcf7a54d9.svg" alt="\pi"/>.</p>
</li>
</ul>
</section>
<section id="id1">
<h2>Marginal Likelihood<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>The marginal likelihood <img class="math" src="_images/math/f789dffdd3bf098dc89bcf1c9aeedf421e41025c.svg" alt="p(\mathbf{Y})"/> is the probability of the observed data after marginalising out all
latent variables of the model. This is the quantity typically used to measure how well a model describes the data and
model parameters are optimised to minimise the marginal negative log likelihood <img class="math" src="_images/math/6e94318be31cbc5b568cede309899496bec86c02.svg" alt="- \log p(\mathbf{Y})"/>. We
obtain the marginal likelihood from the inside probabilities at the root node</p>
<div class="admonition-marginal-likelihood admonition">
<p class="admonition-title">Marginal Likelihood</p>
<div class="math">
<p><img src="_images/math/179c5f838f13a4e1ddbc3afdbee6db76d1b9f409.svg" alt="p(\mathbf{Y}) = \sum_{x\in\mathcal{X}} w_x \int \beta(x_{0:n}) \ p_P(x_{0:n}) \ dx_{0:n},"/></p>
</div></div>
<p>where <img class="math" src="_images/math/c98e45a1f1e64d8ec5ce9ae206ceb16ae385b62b.svg" alt="p_P(x_{0:n})"/> is the prior transition that generates a non-terminal variable of type <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/> from scratch and
<img class="math" src="_images/math/761dd59b284079b25d7b0a4159b30a813df6863a.svg" alt="w_x"/> is the probability of generating a particular template variable of type <img class="math" src="_images/math/888f7c323ac0341871e867220ae2d76467d74d6e.svg" alt="x"/>. Note that this is fundamentally
the same as for normal transitions (<img class="math" src="_images/math/761dd59b284079b25d7b0a4159b30a813df6863a.svg" alt="w_x"/> is the equivalent of the structural distribution), except that some
things simplify as we do not condition on another non-terminal variable and do not have to consider possible splitting points
as we are generating only a single new non-terminal variable. Computing marginal likelihoods from the inside probabilities
at the root node is implemented in <a class="reference internal" href="_autosummary/rbnet.base.Prior.html#rbnet.base.Prior.marginal_likelihood" title="rbnet.base.Prior.marginal_likelihood"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Prior.marginal_likelihood()</span></code></a>,
which essentially corresponds to combining the <a class="reference internal" href="_autosummary/rbnet.base.Transition.html#rbnet.base.Transition.inside_marginals" title="rbnet.base.Transition.inside_marginals"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transition.inside_marginals()</span></code></a>
and <a class="reference internal" href="_autosummary/rbnet.base.Cell.html#rbnet.base.Cell.inside_mixture" title="rbnet.base.Cell.inside_mixture"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cell.inside_mixture()</span></code></a> methods for the special case of the prior.</p>
</section>
<section id="parsing">
<h2>Parsing<a class="headerlink" href="#parsing" title="Link to this heading"></a></h2>
<p>To compute marginal likelihoods, we have to recursively evaluate the equation for general inside probabilities
to obtain their values at the root node. This is done by the <a class="reference internal" href="_autosummary/rbnet.base.RBN.html#rbnet.base.RBN.inside" title="rbnet.base.RBN.inside"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RBN.inside()</span></code></a> method.
It iterates over all inside variables using <a class="reference internal" href="_autosummary/rbnet.base.RBN.html#rbnet.base.RBN.inside_schedule" title="rbnet.base.RBN.inside_schedule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">inside_schedule()</span></code></a>,
delegating the marginalisation of variables to <a class="reference internal" href="_autosummary/rbnet.base.Transition.html#rbnet.base.Transition.inside_marginals" title="rbnet.base.Transition.inside_marginals"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Transition.inside_marginals()</span></code></a>
and computing mixtures to <a class="reference internal" href="_autosummary/rbnet.base.Cell.html#rbnet.base.Cell.inside_mixture" title="rbnet.base.Cell.inside_mixture"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cell.inside_mixture()</span></code></a>, before returning the
marginal likelihood computed via <a class="reference internal" href="_autosummary/rbnet.base.Prior.html#rbnet.base.Prior.marginal_likelihood" title="rbnet.base.Prior.marginal_likelihood"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Prior.marginal_likelihood()</span></code></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Recursive Bayesian Networks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="auto_examples/index.html" class="btn btn-neutral float-right" title="Gallery and Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Robert Lieck.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>